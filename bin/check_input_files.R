#!/usr/bin/env Rscript


###############################################################################
# Make sure the same genes are present in both data frames. This script
# takes as input two files and returns two files containing the same genes.
# filenames will be automatically generated by prepending uni_ to the 
# original file name.
###############################################################################
#renv::activate('/home/bionets-og86asub/Documents/netmap/')
require(data.table)
require(optparse)

option_list <- list( 
  make_option(c("-c", "--input.file.1"), type = 'character',
              help="Input file"),
  make_option(c("-d", "--input.file.2"), type = 'character',
              help="Input file"),
  make_option(c("-t", "--transcription.factors"), type='character',
              help = 'Transcription factor data base with column name "HGNC symbol"'),
  make_option(c("-u", "--tf.output"), type='character',
              help = 'Transcription factor output file'),
  make_option(c("-e", "--output.file.1"), type = 'character',
              help="Input file"),
  make_option(c("-f", "--output.file.2"), type = 'character',
              help="Input file"))
  

# get command line options, if help option encountered print help and exit,
# otherwise if options not found on command line then set defaults, 
opt <- parse_args(OptionParser(option_list=option_list))
# opt$input.file.1<-'/home/bionets-og86asub/Documents/netmap/data/Doc_Spleen_1_d10.tsv'
# opt$input.file.2<-'/home/bionets-og86asub/Documents/netmap/data/Doc_Spleen_1_d10.tsv'
# opt$transcription.factors<-'/home/bionets-og86asub/Documents/netmap/data/DatabaseExtract_v_1.01.csv'
# opt$tf.output<-'/home/bionets-og86asub/Documents/netmap/data/tf.output.tsv'


data.1<-fread(opt$input.file.1, header=T)
data.2<-fread(opt$input.file.2, header = T)

gene.names<-intersect(data.1$Gene, data.2$Gene)

data.1<-data.1[Gene %in% gene.names]
data.2<-data.2[Gene %in% gene.names]

data.1$Gene<-toupper(data.1$Gene)
data.2$Gene<-toupper(data.2$Gene)

fwrite(data.1, file = opt$output.file.1, sep='\t')
fwrite(data.2, file = opt$output.file.2, sep='\t')


transcription.factors<-fread(opt$transcription.factors, header=T)
transcription.factors<-transcription.factors$`HGNC symbol`
transcription.factors<-intersect(transcription.factors, toupper(gene.names))
transcription.factors<-data.table(regulators = transcription.factors)
fwrite(transcription.factors, file = opt$tf.output,sep = '\t')

